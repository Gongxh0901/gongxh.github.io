---
layout: post
title: "kunpocc框架"
date: 2024-12-29 15:00:00 +0800
categories: ["开源项目"]
tags: ["Cocos Creator", "TypeScript", "游戏框架", "开源", "FairyGUI"]
excerpt: "kunpocc 是一个基于 Cocos Creator 的游戏开发框架，提供了一系列实用模块，帮助开发者快速构建高质量的游戏项目。"
---

# kunpocc - 基于 Cocos Creator 的游戏开发框架

kunpocc 是一个专为 Cocos Creator 开发的游戏框架，提供了一套完整的游戏开发工具和模块，旨在帮助开发者快速构建高质量的游戏项目。项目完全使用 TypeScript 编写，提供完整的类型定义支持。

## 项目背景

在游戏开发过程中，开发者经常需要重复实现一些通用功能，如UI管理、计时器、平台适配、屏幕尺寸处理等。kunpocc 通过提供这些常用模块的标准化实现，让开发者能够专注于游戏逻辑本身，而不是基础架构的搭建。

## 核心特性

### 🎮 完整的游戏开发支持
- **UI模块**：基于 FairyGUI 的完善UI管理系统，支持灵活的装饰器语法
- **全局计时器**：高精度计时器管理，支持一次性、循环和无限循环定时器
- **平台工具**：支持多平台检测（iOS、Android、HarmonyOS、微信小游戏等）
- **屏幕尺寸**：多分辨率适配解决方案，提供安全区域适配

### 📱 小游戏开发优化
- **小游戏接口封装**：统一的小游戏平台API，支持微信、支付宝、抖音小游戏
- **广告系统**：封装激励视频广告接口
- **支付系统**：跨平台支付解决方案
- **热更新**：基于官方热更新方案的简化封装
- **条件显示节点**：用于UI红点等状态显示的组件系统

### 🛠️ 开发者友好
- **TypeScript 支持**：完整的类型定义，智能代码提示
- **UI装饰器**：灵活的UI装饰器系统（配合 `kunpo-fgui` 插件）
- **Creator 3.7+ 兼容**：支持最新版本的 Cocos Creator
- **模块化设计**：按需使用，减少最终包体积

## 版本支持

- **Cocos Creator 3.7+**：完全支持
- **Cocos Creator 3.8+**：完全支持
- **更早版本**：理论上支持（未充分测试）

## 快速开始

### 安装

kunpocc 已发布到 npm，可以通过以下方式安装：

```bash
npm install kunpocc
```

如果网络连接不稳定，可以使用国内镜像：

```bash
# 官方源
npm set registry https://registry.npmjs.org

# 中国镜像站（推荐）
npm set registry https://registry.npmmirror.com/

# 腾讯
npm set registry https://mirrors.cloud.tencent.com/npm/

# 华为
npm set registry https://repo.huaweicloud.com/repository/npm/

# 阿里
npm set registry https://npm.aliyun.com
```

### 基础项目配置

1. **创建头部引用文件**

首先在脚本目录下创建 `header.ts` 文件：

```typescript
import * as fgui from "fairygui-cc";
import * as kunpo from "kunpocc";

export { fgui, kunpo };
```

2. **创建入口脚本**

```typescript
import { _decorator } from "cc";
import { fgui, kunpo } from './header';

const { ccclass, property, menu } = _decorator;

@ccclass("GameEntry")
@menu("kunpo/GameEntry")
export class GameEntry extends kunpo.CocosEntry {
    onInit(): void {
        kunpo.log("GameEntry onInit");
    }
}
```

3. **场景节点配置**

在首场景中创建以下节点结构：
- `GameEntry`：入口节点，绑定上面的脚本
- `UI`：UI模块节点
- `window`：UI容器节点

## 核心模块详解

### 1. UI模块

基于 FairyGUI 的强大UI管理系统，支持装饰器语法和多窗口管理。

#### 主要特点

- 基于 FairyGUI，查看 [FairyGUI官方文档](https://www.fairygui.com/docs/editor)
- 灵活的 UI 装饰器（配合插件 `kunpo-fgui` 使用）
- 控制窗口之间的相互关系
- 多窗口组管理
- 支持资源栏（header）复用

#### 装饰器使用

**窗口装饰器**：
```typescript
import { fgui, kunpo } from '../header';
const { uiclass, uiprop, uiclick } = kunpo._uidecorator;

/** 
 * 窗口装饰器
 * @param 参数1: 窗口容器节点名字
 * @param 参数2: FairyGUI中的UI包名
 * @param 参数3: FairyGUI中的组件名（必须和类名同名）
 */
@uiclass("Window", "Home", "MyWindow")
export class MyWindow extends kunpo.Window {
    @uiprop private btnConfirm: fgui.GButton;
    @uiprop private txtTitle: fgui.GTextField;
    @uiprop private listItems: fgui.GList;
    
    @uiclick
    private onConfirmClick(event: cc.Event): void {
        console.log('确认按钮被点击');
    }
    
    protected onInit(): void {
        this.adapterType = kunpo.AdapterType.Bang;
        this.type = kunpo.WindowType.CloseAll;
        this.bgAlpha = 0;
    }

    protected onShow(userdata?: any): void {
        kunpo.log("窗口显示:", userdata);
    }
}
```

**窗口管理**：
```typescript
// 异步打开窗口（自动加载资源）
kunpo.WindowManager.showWindow("MyWindow", userData);

// 立即打开窗口（已加载资源）
kunpo.WindowManager.showWindowIm("MyWindow", userData);

// 关闭窗口
kunpo.WindowManager.closeWindow("MyWindow");

// 获取窗口实例
const window = kunpo.WindowManager.getWindow<MyWindow>("MyWindow");
```

#### 窗口生命周期

- `onInit`: 窗口初始化时调用
- `onShow`: 窗口显示时调用
- `onClose`: 窗口关闭时调用
- `onHide`: 窗口隐藏时调用
- `onShowFromHide`: 窗口从隐藏状态恢复时调用
- `onCover`: 窗口被覆盖时调用
- `onRecover`: 窗口恢复时调用
- `onEmptyAreaClick`: 点击窗口空白区域时调用

### 2. 全局计时器

高效的计时器管理系统，支持多种计时模式：

```typescript
import { kunpo } from './header';

// 启动一次性定时器（2秒后执行）
const timerId1 = kunpo.GlobalTimer.startTimer(() => {
    console.log('2秒后执行一次');
}, 2);

// 启动循环定时器（每3秒执行一次，执行5次）
const timerId2 = kunpo.GlobalTimer.startTimer(() => {
    console.log('每3秒执行一次，总共执行5次');
}, 3, 5);

// 启动无限循环定时器（每1秒执行一次）
const timerId3 = kunpo.GlobalTimer.startTimer(() => {
    console.log('每1秒执行一次，无限循环');
}, 1, -1);

// 停止定时器
kunpo.GlobalTimer.stopTimer(timerId1);
```

**参数说明**：
- 时间间隔单位为秒
- loop 参数：0（执行一次）、正整数 n（执行 n 次）、-1（无限循环）

### 3. 平台工具

跨平台兼容性工具，支持各种平台的检测和适配：

```typescript
import { kunpo } from './header';

// 平台类型枚举
enum PlatformType {
    Android = 1,    // 安卓
    IOS,            // iOS
    HarmonyOS,      // 鸿蒙
    WX,             // 微信小游戏
    Alipay,         // 支付宝小游戏
    Bytedance,      // 字节小游戏
    HuaweiQuick,    // 华为快游戏
    Browser         // 浏览器
}

// 平台检测
if (kunpo.Platform.isNativeMobile) {
    // 原生移动平台的处理
    if (kunpo.Platform.isAndroid) {
        // 安卓特有功能
    } else if (kunpo.Platform.isIOS) {
        // iOS特有功能
    }
} else if (kunpo.Platform.isWX || kunpo.Platform.isAlipay || kunpo.Platform.isBytedance) {
    // 小游戏平台的处理
} else {
    // 浏览器平台的处理
}
```

### 4. 屏幕尺寸管理

多分辨率适配解决方案，提供完整的屏幕信息：

```typescript
import { kunpo } from './header';

// 屏幕尺寸相关属性
console.log('屏幕宽度:', kunpo.Screen.ScreenWidth);
console.log('屏幕高度:', kunpo.Screen.ScreenHeight);
console.log('设计分辨率宽:', kunpo.Screen.DesignWidth);
console.log('设计分辨率高:', kunpo.Screen.DesignHeight);
console.log('安全区外一侧高度:', kunpo.Screen.SafeAreaHeight);
console.log('安全区宽度:', kunpo.Screen.SafeWidth);
console.log('安全区高度:', kunpo.Screen.SafeHeight);
```

### 5. 小游戏接口封装

统一的小游戏平台API封装，支持微信、支付宝、抖音小游戏：

#### 通用接口

```typescript
import { kunpo } from './header';

// 获取启动参数
const launchOptions = kunpo.MiniHelper.getLaunchOptions();

// 获取基础库版本
const version = kunpo.MiniHelper.getLibVersion();

// 获取运行平台
const platform = kunpo.MiniHelper.getPlatform();

// 复制到剪切板
kunpo.MiniHelper.setClipboardData("复制的内容");
```

#### 广告系统

```typescript
// 初始化广告
kunpo.MiniHelper.ad().init(adUnitId);

// 展示广告
kunpo.MiniHelper.ad().showAds({
    success: () => {
        kunpo.log("广告展示完成，发放奖励");   
    }, 
    fail: (errCode: number, errMsg: string) => {
        kunpo.log("广告展示失败 code:" + errCode + " msg:" + errMsg);
    }
});
```

#### 支付系统

```typescript
// 初始化支付
kunpo.MiniHelper.pay().init(offerId, unitPriceQuantity);

// 检查价格是否满足限制
if (kunpo.MiniHelper.pay().isPayable(6)) {
    // 拉起支付
    kunpo.MiniHelper.pay().pay({
        rmb: 6,
        orderId: "唯一订单号",
        shopId: "商品id",
        shopName: "商品名",
        success: () => {
            kunpo.log("支付调用成功，去服务端验单");
        },
        fail: (res) => {
            kunpo.log("支付调用失败", res.errCode, res.errMsg);
        }
    });
}
```

### 6. 热更新系统

基于 Creator 官方热更新方案的简化封装，支持动态变更资源路径：

```typescript
import { kunpo } from './header';

// 初始化热更新管理器
kunpo.HotUpdateManager.getInstance().init(manifestUrl, version);

// 检查更新
kunpo.HotUpdateManager.getInstance().checkUpdate().then((res) => {
    console.log(`发现更新，资源大小:${res.size}kb`);
}).catch((err) => {
    if (err.code == kunpo.HotUpdateCode.LatestVersion) {
        console.log('已经是最新版本');
    } else {
        console.log(`检查更新失败: ${err.message}`);
    }
});

// 开始更新
kunpo.HotUpdateManager.getInstance().startUpdate({
    skipCheck: false,
    progress: (kb: number, total: number) => {
        kunpo.log("热更新进度", kb, total);
    },
    complete: (code: kunpo.HotUpdateCode, message: string) => {
        if (code == kunpo.HotUpdateCode.Succeed) {
            console.log('更新成功');
        } else {
            console.log(`更新失败: ${message}`);
        }
    }
});
```

### 7. 条件显示节点

用于UI状态显示的组件，常用于红点提示等场景：

```typescript
import { kunpo } from './header';

// 定义条件类型
enum ConditionType {
    mail,
    shop,
    achievement,
}

// 定义条件类
@kunpo.conditionClass(ConditionType.mail)
export class MailCondition extends kunpo.ConditionBase {
    protected onInit(): void {
        // 监听条件变化
        kunpo.GlobalEvent.add("mailUpdate", () => {
            this.tryUpdate();
        }, this);
    }

    protected evaluate(): boolean {
        // 根据条件数据返回 true 或 false
        return MailManager.hasUnreadMail();
    }
}

// 节点关联条件
// 任意一个满足则显示节点
new kunpo.ConditionAnyNode(fguiObject, ConditionType.mail, ConditionType.shop);

// 所有条件都满足才显示节点
new kunpo.ConditionAllNode(fguiObject, ConditionType.mail, ConditionType.achievement);
```

### 8. 时间工具

提供完整的时间处理功能，支持服务器时间同步：

```typescript
import { kunpo } from './header';

// 设置服务器时间（同步本地时间）
kunpo.Time.setNetTime(serverTimestamp);

// 获取当前时间（已同步服务器时间）
const now = kunpo.Time.now();

// 时间格式化
const formatted = kunpo.Time.formatTime(now); // xxxx-xx-xx HH:MM:SS
const chinese = kunpo.Time.formatTimeChinese(now); // xxxx年xx月xx日 HH:MM:SS

// 获取时间信息
const timeInfo = kunpo.Time.getTime(now);
console.log(`${timeInfo.year}年${timeInfo.month}月${timeInfo.day}日`);

// 判断是否同一天
const isSame = kunpo.Time.isSameDay(timestamp1, timestamp2);
```

### 9. 数学工具

提供常用的数学计算工具：

```typescript
import { kunpo } from './header';

// 数值限制
const clampedValue = kunpo.MathTool.clampf(75, 0, 100); // 返回75

// 随机数生成
const randomInt = kunpo.MathTool.rand(1, 10); // 1到10的整数
const randomFloat = kunpo.MathTool.randRange(0, 1); // 0到1的浮点数

// 角度弧度转换
const radian = kunpo.MathTool.rad(90); // 90度转弧度
const degree = kunpo.MathTool.deg(Math.PI); // π弧度转角度

// 平滑过渡
const smoothValue = kunpo.MathTool.smooth(0, 100, 0.16, 0.3);

// MD5加密
const hash = kunpo.md5('Hello, World!');
```

## 配套工具

### kunpo-fgui 插件

kunpocc 提供了配套的 Cocos Creator 插件，可以一键导出界面配置：

- **插件地址**: [Cocos Store - kunpo-fgui](https://store.cocos.com/app/detail/7213)
- **功能特点**：
  - 一键导出FairyGUI界面配置
  - 自动识别UI装饰器
  - 大大提升开发效率

## 独立模块生态

除了核心框架，kunpocc 还提供了一系列独立模块：

1. [ec模块](https://github.com/Gongxh0901/kunpo-ec) - 实体组件系统
2. [ecs模块](https://github.com/Gongxh0901/kunpo-esc) - 实体组件系统增强版
3. [网络模块](https://github.com/Gongxh0901/kunpocc-net) - HTTP和Socket网络通信
4. [四叉树](https://github.com/Gongxh0901/kunpo-quadtree) - 空间分割算法
5. [行为树](https://github.com/Gongxh0901/kunpocc-behaviortree) - AI行为树系统
6. [资源管理](https://github.com/Gongxh0901/kunpocc-assets) - 资源加载管理
7. [全局事件](https://github.com/Gongxh0901/kunpocc-event) - 事件系统

## 入门指南

### 新手教程

对于初次使用的开发者，建议按照以下步骤学习：

1. **项目配置**：按照基础配置搭建项目框架
2. **UI系统**：学习 FairyGUI 和窗口管理
3. **功能模块**：逐步集成需要的功能模块
4. **插件使用**：配合 kunpo-fgui 插件提升效率

具体的新手使用指南请参考项目文档中的详细教程。

## 项目特色

### TypeScript 完全支持

该库完全使用 TypeScript 编写，提供：
- 完整的类型定义文件
- 智能代码提示
- 编译时错误检查
- 更好的开发体验

### 模块化设计

采用模块化架构，开发者可以按需使用：
- 每个模块相对独立
- 支持按需导入
- 减少最终包体积
- 提升加载性能

### 持续优化

项目处于持续优化状态：
- 定期更新和维护
- 性能持续优化
- 新功能不断添加
- 社区反馈积极响应

## 项目信息

- **GitHub**: [https://github.com/gongxh0901/kunpolibrary](https://github.com/gongxh0901/kunpolibrary)
- **NPM**: [kunpocc](https://www.npmjs.com/package/kunpocc)

## 相关链接

- **kunpo-fgui 插件**: [Cocos Store](https://store.cocos.com/app/detail/7213)

## 贡献指南

kunpocc 欢迎社区贡献：

1. **问题反馈**：通过 GitHub Issues 报告 bug 或提出建议
2. **代码贡献**：提交 Pull Request 改进代码
3. **文档完善**：帮助完善文档和示例
4. **功能建议**：提出新功能需求

## 总结

kunpocc 致力于为 Cocos Creator 开发者提供一个高效、易用的游戏开发框架。通过基于 FairyGUI 的强大UI系统和丰富的功能模块，无论是独立开发者还是团队项目，kunpocc 都能为您的游戏开发之旅提供强有力的支持。

项目持续优化中，敬请期待更多功能和改进！ 